# FANZAの探すやつ (FANZA Helper)

Webページ上のFANZA（DMM）の商品リンクを検出し、外部サイト（MissAV, Tktube）での在庫・転載状況を自動でチェックして表示するTampermonkey用ユーザースクリプトです。

## 概要

ページ内に存在するFANZA/DMMの動画リンクを自動的に解析し、以下の機能を提供します：

1.  **商品IDの抽出**: 複雑なURLから品番（例: `abc-123`）を整形して抽出。
2.  **外部サイト検索**: MissAVおよびTktubeに対してバックグラウンドでアクセスし、該当動画のページが存在するかを確認します。
3.  **ジャンル表示**: URL構造から「一般AV」「VR」「素人・企画」「アニメ」などのジャンルを判別して表示します。
4.  **ステータスアイコン**: リンクの生存確認状況をアイコンで視覚的に通知します。

## 機能詳細

### 1. 対応サイト・検出
`dmm.co.jp` 形式のリンクが含まれるあらゆるWebサイトで動作します。動的に読み込まれるコンテンツ（無限スクロールなど）にも `MutationObserver` を使用して対応しており、ページ遷移なしに追加されたリンクも検知します。

### 2. ステータスアイコンの意味
各ボタンの右側に表示されるアイコンの意味は以下の通りです。

| アイコン | 状態 | 説明 |
| :---: | :--- | :--- |
| ⌛ | **確認中** | 外部サイトへ接続し、ページの有無を確認しています。（v8.0で復活） |
| ⭕ | **発見** | 対象のサイトに動画ページが存在します（ステータスコード 200番台）。 |
| ❌ | **なし** | 対象のサイトに動画ページが見つかりませんでした。 |
| ❓ | **エラー** | タイムアウトまたは接続エラーが発生しました。 |

### 3. UIの改善（v8.0）
* **サイト名小文字化**: `missav`, `tktube` と小文字表記に統一し、シンプルで見やすいデザインに変更。
* **ツールバー**: リンクの下に控えめなツールバーを表示し、元のWebデザインを極力崩さないように配慮しています。

## インストール方法

1.  ブラウザ拡張機能 **Tampermonkey** をインストールしてください。
    * [Chrome版](https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo)
    * [Firefox版](https://addons.mozilla.org/ja/firefox/addon/tampermonkey/)
2.  Tampermonkeyのダッシュボードを開き、「新規スクリプトを追加」を選択します。
3.  エディタにスクリプトの内容をすべて貼り付けます。
4.  `ファイル` > `保存` をクリックします。

## 動作環境

* **Browser**: Chrome, Firefox, Edge, etc.
* **Manager**: Tampermonkey, Violentmonkey
* **Permissions**: `GM_xmlhttpRequest` (クロスオリジン通信のため必須)

## 開発者向け情報

### 接続先ドメイン
スクリプトヘッダーの `@connect` に以下のドメインを指定しています。
* `missav.ws`
* `tktube.com`

## 免責事項

* このツールはリンクの生存確認を補助するための開発用・学習用ツールです。
* このスクリプトを使用して発生したいかなる問題や損害についても、作者は責任を負いません。
* 各サイトの利用規約を遵守してご利用ください。
* 自作発言や無断転載はお控えください

---

### 更新履歴
* **v8.0**: 砂時計アイコン（⌛）の復活、サイト名表記の小文字化、UIスタイルの調整、接続処理の最適化。
